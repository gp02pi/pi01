{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Estoque</title>
    <link rel="icon" href="{% static 'img/favi.png' %}" type="image/x-icon" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="{% static 'css/produtos.css' %}" />
</head>
<body>
    {% include 'barra.html' %}
    <div id="toast-message" class="toast-message"></div>
    <div id="confirm-modal" class="modal" onclick="closeConfirmModal()">
        <div class="modal-content modal-confirm-content" onclick="event.stopPropagation()">
            <h2>Confirmar Exclusão</h2>
            <p id="confirm-modal-text">Tem certeza que deseja excluir este produto? Essa ação não pode ser desfeita.</p>
            <div class="form-buttons">
                <button type="button" class="delete" id="confirm-delete-btn">Excluir</button>
                <button type="button" class="cancel" onclick="closeConfirmModal()">Cancelar</button>
            </div>
        </div>
    </div>
    <div id="note-confirm-modal" class="modal" onclick="closeNoteConfirmModal()">
        <div class="modal-content modal-confirm-content" onclick="event.stopPropagation()">
            <h2>Confirmar Exclusão</h2>
            <p id="note-confirm-modal-text">Tem certeza que deseja excluir esta nota fiscal? Essa ação não pode ser desfeita.</p>
            <div class="form-buttons">
                <button type="button" class="delete" id="note-confirm-delete-btn">Excluir</button>
                <button type="button" class="cancel" onclick="closeNoteConfirmModal()">Cancelar</button>
            </div>
        </div>
    </div>
    <div class="modal" id="fornecedor-modal">
    <div class="modal-content">
        <h2>Cadastro Rápido de Fornecedor</h2>
        <form id="fornecedor-form" onsubmit="adicionarFornecedor(event)">
            <div class="input-group">
                <div class="input-field-group">
                    <label for="quick-add-nome">Nome da Empresa</label>
                    <input type="text" id="quick-add-nome" placeholder="Nome completo da empresa" required>
                </div>
                <div class="input-field-group">
                    <label for="quick-add-cnpj">CNPJ</label>
                    <input type="text" id="quick-add-cnpj" placeholder="Apenas números" required>
                </div>
            </div>
            <div class="input-group">
                <div class="input-field-group">
                    <label for="quick-add-email">Email</label>
                    <input type="email" id="quick-add-email" placeholder="email@exemplo.com" required>
                </div>
                <div class="input-field-group">
                    <label for="quick-add-telefone">Telefone</label>
                    <input type="text" id="quick-add-telefone" placeholder="Com DDD, apenas números" required>
                </div>
            </div>
            <div class="input-group">
                <div class="input-field-group">
                    <label for="quick-add-cep">CEP</label>
                    <input type="text" id="quick-add-cep" placeholder="00000-000" required>
                </div>
                <div class="input-field-group">
                    <label for="quick-add-street">Rua/N°/Bairro</label>
                    <input type="text" id="quick-add-street" placeholder="Rua Exemplo, 123 - Bairro" required>
                </div>
            </div>
            <div class="input-group">
                <div class="input-field-group">
                    <label for="quick-add-city">Cidade</label>
                    <input type="text" id="quick-add-city" placeholder="Preenchimento automático" required readonly>
                </div>
                <div class="input-field-group">
                    <label for="quick-add-state">Estado</label>
                    <input type="text" id="quick-add-state" placeholder="Preenchimento automático" required readonly>
                </div>
            </div>
            <div class="form-buttons">
                <button type="button" class="cancel" onclick="closeFornecedorModal()">Cancelar</button>
                <button type="submit">Salvar Fornecedor</button>
            </div>
        </form>
    </div>
</div>
    <div class="all">
        <div class="header">
            <div class="search-container">
                <i class="fas fa-search"></i>
                <input type="text" id="search-bar" placeholder="Buscar produto..." oninput="filtrarProdutos()" />
            </div>
            <button class="header-btn export-btn" id="export-btn" onclick="exportarPlanilha()">
                <i class="fas fa-file-excel"></i> Exportar
            </button>
            <button class="header-btn delete-selected-btn" id="delete-selected-btn">
                <i class="fas fa-trash-alt"></i> Excluir
            </button>
            <button class="header-btn add-btn" id="add-btn" onclick="openModal()">+ Novo Item</button>
        </div>
        <div id="product-modal" class="modal" onclick="closeModal()">
            <div class="modal-content" onclick="event.stopPropagation()">
                <h2>Adicionar Produto</h2>
                <form id="product-form" onsubmit="adicionarProduto(event)">
                    <input type="hidden" name="id" id="product-id" />
                    <div class="input-group">
                        <div class="input-field-group autocomplete-container">
                            <label for="nome-input">Nome do Produto</label>
                            <input type="text" id="nome-input" name="nome" placeholder="Busque por um produto existente ou crie um novo" required autocomplete="off" />
                            <ul id="product-suggestions" class="autocomplete-list"></ul>
                        </div>
                        <div class="input-field-group">
                            <label for="quantidade-input">Quantidade a Adicionar</label>
                            <input type="number" id="quantidade-input" name="quantidade" placeholder="Ex: 10" min="0" required />
                        </div>
                    </div>
                    <div class="input-group">
                        <div class="input-field-group">
                            <label for="preco_compra-input">Preço de Compra</label>
                            <input type="text" id="preco_compra-input" name="preco_compra" placeholder="R$ 0,00" oninput="formatPrice(event)" required />
                        </div>
                        <div class="input-field-group">
                            <label for="preco_venda-input">Preço de Venda</label>
                            <input type="text" id="preco_venda-input" name="preco_venda" placeholder="R$ 0,00" oninput="formatPrice(event)" required />
                        </div>
                    </div>
                    <div class="input-group">
                        <div class="input-field-group">
                            <label for="fornecedor-search">Fornecedor</label>
                            <div class="autocomplete-container">
                                <input type="text" id="fornecedor-search" placeholder="Busque ou cadastre um fornecedor" required />
                                <button type="button" class="add-fornecedor-btn" onclick="openFornecedorModal()">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <input type="hidden" name="fornecedor_cnpj" id="fornecedor-cnpj-hidden" />
                                <ul id="fornecedor-suggestions" class="autocomplete-list"></ul>
                            </div>
                            <small class="fornecedor-warning" id="fornecedor-warning">Por favor, selecione um fornecedor válido.</small>
                        </div>
                        <div class="input-field-group">
                            <label for="quantidade-minima-input">Qtd. Mínima (Opcional)</label>
                            <input type="number" id="quantidade-minima-input" name="quantidade_minima" placeholder="Ex: 5" min="0" />
                        </div>
                    </div>
                    <div class="input-group">
                        <div class="input-field-group">
                            <label for="nota_fiscal-input">Nota Fiscal</label>
                            <input type="text" id="nota_fiscal-input" name="nota_fiscal" placeholder="Obrigatório para adicionar estoque" required />
                        </div>
                    </div>
                    <div class="form-buttons">
                        <button type="button" class="cancel" onclick="closeModal()">Cancelar</button>
                        <button type="submit">Adicionar Produto</button>
                    </div>
                </form>
            </div>
        </div>
        <div id="notes-modal" class="modal modal-notes" onclick="closeNotesModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h2>Histórico de Notas Fiscais</h2>
            </div>
        <div class="notes-table-container">
            <table class="notes-table">
                <thead>
                    <tr>
                        <th style="width: 20px;"></th>
                        <th>Número da Nota</th>
                        <th>Quantidade</th>
                        <th>Data de Entrada</th>
                    </tr>
                </thead>
                <tbody id="notes-table-body"></tbody>
            </table>
        </div>
        <div class="form-buttons">
            <button type="button" class="cancel" onclick="closeNotesModal()">Fechar</button>
            <button type="button" class="delete-notes-btn" id="delete-selected-notes-btn" style="display: none;">
                <i class="fas fa-trash-alt"></i> Excluir Selecionadas
            </button>
        </div>
    </div>
</div>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Código</th>
                        <th>Nome</th>
                        <th>Qtd</th>
                        <th>Preço Compra</th>
                        <th>Preço Venda</th>
                        <th>Fornecedor</th>
                        <th>Nota Fiscal</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="product-table-body">
                </tbody>
            </table>
        </div>
        <div class="pagination-container" id="pagination-container"></div>
    </div>
    <script src="{% static 'js/produtos.js' %}"
        data-produtos-url="{% url 'api_produtos' %}"
        data-produtos-exportar-url="{% url 'api_exportar_produtos' %}"
        data-fornecedores-url="{% url 'api_fornecedores' %}"
        data-historico-notas-url="{% url 'api_historico_notas' %}"
        data-csrf-token="{{ csrf_token }}">
    </script>
</body>
</html>