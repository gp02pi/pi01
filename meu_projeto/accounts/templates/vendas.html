{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Registro de Vendas</title>

    <link rel="icon" href="{% static 'img/favi.png' %}" type="image/x-icon" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    
    <link rel="stylesheet" href="{% static 'css/vendas.css' %}" />
</head>
<body>
    {% include 'barra.html' %}

    <div class="container">
        <div class="header">
            <div class="search-container">
                <i class="fas fa-search"></i>
                <input type="text" id="search-bar" placeholder="Buscar por produto, cliente ou data..." oninput="filtrarVendas()" />
            </div>
            <button class="add-btn" onclick="openModal()">+ Nova Venda</button>
        </div>

        <div id="sales-grid" class="sales-grid"></div>

        <div id="venda-modal" class="modal" onclick="closeModal()">
            <div class="modal-content" onclick="event.stopPropagation()">
                <div class="modal-header">
                    <h2 id="modal-title">Registrar Venda</h2>
                </div>
                <form id="venda-form" onsubmit="registrarVenda(event)">
                    <input type="hidden" name="id" id="venda-id" />
                    <div class="modal-body">
                        <div class="input-group">
                            <label for="produto-search">Produto</label>
                            <div class="search-select-container" id="produto-select-container"></div>
                        </div>
                        <div class="input-group">
                            <div class="label-container">
                                <label for="cliente-search">Cliente</label>
                                <button type="button" class="quick-add-btn" onclick="openClienteRapidoModal(event)">
                                    <i class="fas fa-plus"></i> Cadastro Rápido
                                </button>
                            </div>
                            <div class="search-select-container" id="cliente-select-container"></div>
                        </div>
                        <div class="input-group">
                            <label for="quantidade-venda">Quantidade</label>
                            <input type="number" name="quantidade_venda" id="quantidade-venda" placeholder="Quantidade vendida" min="1" required />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="cancel-btn" onclick="closeModal()">Cancelar</button>
                        <button type="submit" id="confirm-button" class="confirm-btn">Registrar Venda</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="cliente-rapido-modal" class="modal" onclick="closeClienteRapidoModal()">
            <div class="modal-content" onclick="event.stopPropagation()">
                <div class="modal-header">
                    <h2>Cadastro Rápido de Cliente</h2>
                </div>
                <form id="cliente-rapido-form" onsubmit="registrarClienteRapido(event)">
                    <div class="modal-body">
                        <div class="input-group">
                            <label for="cliente-rapido-nome">Nome Completo</label>
                            <input type="text" id="cliente-rapido-nome" placeholder="Nome completo do cliente" required>
                        </div>
                        <div class="input-group">
                            <label for="cliente-rapido-cpf">CPF</label>
                            <input type="text" id="cliente-rapido-cpf" placeholder="000.000.000-00" required>
                        </div>
                        <div class="input-group">
                            <label for="cliente-rapido-email">Email</label>
                            <input type="email" id="cliente-rapido-email" placeholder="email@exemplo.com" required>
                        </div>
                        <div class="input-group">
                            <label for="cliente-rapido-telefone">Telefone</label>
                            <input type="text" id="cliente-rapido-telefone" placeholder="Digite apenas números" required>
                        </div>
                        <div class="input-group">
                            <label for="cliente-rapido-cep">CEP</label>
                            <input type="text" id="cliente-rapido-cep" placeholder="00000-000" required>
                        </div>
                        <div class="input-group">
                            <label for="cliente-rapido-endereco">Rua/N°/Bairro</label>
                            <input type="text" id="cliente-rapido-endereco" placeholder="Rua Exemplo, 123 - Bairro" required>
                        </div>
                        <div class="input-group">
                            <label for="cliente-rapido-cidade">Cidade</label>
                            <input type="text" id="cliente-rapido-cidade" placeholder="Preenchimento automático" required readonly>
                        </div>
                        <div class="input-group">
                            <label for="cliente-rapido-estado">Estado</label>
                            <input type="text" id="cliente-rapido-estado" placeholder="Preenchimento automático" required readonly>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="cancel-btn" onclick="closeClienteRapidoModal()">Cancelar</button>
                        <button type="submit" class="confirm-btn">Salvar Cliente</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="confirm-delete-modal" class="modal" onclick="closeDeleteModal()">
            <div class="modal-content" onclick="event.stopPropagation()">
                <div class="modal-header">
                    <h3><i class="fas fa-exclamation-triangle"></i>Confirmar Exclusão</h3>
                </div>
                <div class="modal-body">
                    <p id="delete-message">Você tem certeza que deseja excluir esta venda?</p>
                    <p class="stock-warning" id="stock-warning-message">
                        Atenção: A quantidade vendida retornará ao estoque do produto.
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="cancel-btn" onclick="closeDeleteModal()">Cancelar</button>
                    <button type="button" id="confirm-delete-btn" class="confirm-btn">Excluir Venda</button>
                </div>
            </div>
        </div>

        <div class="popup-msg" id="popupMsg"></div>
        <div id="toast-message" class="toast-message"></div>
    </div>

    <script src="{% static 'js/vendas.js' %}"></script>
</body>
</html>